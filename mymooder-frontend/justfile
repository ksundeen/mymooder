set shell := ["bash", "-uc"]
set dotenv-load

project_frontend := "mymooder-frontend"
project_src := "src"
flags := env_var_or_default("JUST_FLAGS", "-eo pipefail")
thumbup := "\\U1F44D"
check := "\\U2705"
warn := "\\U26A0"
# NVM_DIR := "/root/.nvm"
NVM_DIR := "${HOME}/.nvm"
node_version := "20.10.0"

# Containers
docker_root := "docker"

# Install Dependencies for the React Native Front End

# Start the React Native Front End
# install-frontend:
#     #!/usr/bin/env bash
#     set {{flags}}
#     # pushd ./{{project_frontend}}
#     just install-nvm

# Install nvm. 
install-nvm:
    #!/usr/bin/env bash
    set {{flags}}
    sudo apt install -y curl
    sudo curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
    export NVM_DIR="$HOME/.nvm" > "$NVM_DIR/.nvmrc"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" > "$NVM_DIR/.nvmrc"  # This loads nvm
    [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  > "$NVM_DIR/.nvmrc"  # This loads nvm bash_completion
    
    source ~/.bashrc
    . "$NVM_DIR/nvm.sh" && nvm install {{node_version}}
    . "$NVM_DIR/nvm.sh" && nvm use v{{node_version}}
    . "$NVM_DIR/nvm.sh" && nvm alias default v{{node_version}}
    node --version > "$NVM_DIR/.nvmrc" 
    npm --version > "$NVM_DIR/.nvmrc" 

# If developing through cloud expo resources, install dependencies
# This also sets the name of the project to src
install-expo-tools:
    #!/usr/bin/env bash
    source ~/.bashrc    

    ## Installing with cloud building through Expo from https://docs.expo.dev/get-started/set-up-your-environment/?platform=ios&device=physical
    npm install -g eas-cli

    # Login into Expo Application Service (EAS)
    eas login

    # Enroll in the Apple Developer Program for a personal device 

# Build App to Be Transfered to a DOckerfile for deployment
    # # Sign up for expo account
    # curl https://expo.dev/signup
    # Create the build cobnfig
    eas build:configure
    
    # Create the build
    eas build --platform android --profile development

# Install React Native Sample App
install-rn-packages:
    #!/usr/bin/env bash
    source ~/.bashrc
    set {{flags}}
    pushd {{project_src}}

    # Install additioanal package to include sqlite storage
    npm install --save react-native-sqlite-storage
    apt install gradles


# Build production docker image
build-docker:
    #!/usr/bin/env bash
    set {{flags}}
    pushd "{{docker_root}}"
    docker build --tag {{project_frontend}} .